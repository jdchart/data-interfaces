import{f as O,a as B,c as ee,b as W}from"./2nd4cOeL.js";import{i as X}from"./BorxfLZj.js";import{I as q,P as e,Q as _,ai as te,R as i,M as J,J as ae,S as A,T as z,O as C,K as re,F as V}from"./BGMCiVOv.js";import{e as S,s as ie}from"./BcTKq6Ah.js";import{i as D}from"./C8XnJx7L.js";import{b as E}from"./l_RTz4ho.js";import{p as M,b as K}from"./CyiI0agj.js";import{c as oe,o as ne}from"./BIKdY9KO.js";var se=O('<canvas width="800" height="24" class="svelte-1cgnnos"></canvas>');function le(P,f){q(f,!1);let o=_(),t;const v=oe();ne(async()=>{t=e(o).getContext("2d"),n(),window.addEventListener("resize",resizeCanvas)});function n(){let r=Math.floor(e(o).getBoundingClientRect().width);te(o,e(o).width=r),g()}let s=M(f,"mode",8,"slider");M(f,"audioBuffer",8);let y=M(f,"currentTime",8,0),m=M(f,"duration",8,0);function l(r){return r/m()*e(o).width}function h(r){return r/e(o).width*m()}function x(){t.clearRect(0,0,e(o).width,e(o).height)}const g=()=>{t&&(x(),s()==="slider"&&F(),s()==="waveform"&&drawWaveform(),s()==="spectrogram"&&drawSpectrogram())};function F(){const r=e(o).height/2;t.strokeStyle="#ccc",t.lineWidth=2,t.beginPath(),t.moveTo(0,r),t.lineTo(e(o).width,r),t.stroke(),t.fillStyle="#007aff",t.beginPath(),t.arc(l(y()),r,6,0,Math.PI*2),t.fill()}function k(r){const w=e(o).getBoundingClientRect(),R=Math.max(0,Math.min(r.clientX-w.left,w.width));v("seek",{seek_to:h(R)}),g()}var b={render:g};X();var p=se();return K(p,r=>i(o,r),()=>e(o)),S("pointerdown",p,k),S("pointermove",p,r=>r.buttons&&k(r)),B(P,p),E(f,"render",g),J(b)}var ce=W('<svg viewBox="6 -1 24 24" class="svelte-kd7dba"><rect x="5" y="4" width="4" height="16"></rect><rect x="15" y="4" width="4" height="16"></rect></svg>'),de=W('<svg viewBox="6 -1 24 24" class="svelte-kd7dba"><polygon points="5,3 19,12 5,21"></polygon></svg>'),fe=O('<div class="cont svelte-kd7dba"><button class="icon-btn svelte-kd7dba" title="playpause"><!></button> <button class="icon-btn svelte-kd7dba" title="stop"><svg viewBox="6 -1 24 24" class="svelte-kd7dba"><rect x="5" y="5" width="14" height="14"></rect></svg></button> <button class="icon-btn svelte-kd7dba" title="stop"><svg viewBox="6 -1 24 24" class="svelte-kd7dba"><path d="M17 1l4 4-4 4V6H7a4 4 0 0 0 0 8h1v2H7a6 6 0 0 1 0-12h10V1z"></path><path d="M7 23l-4-4 4-4v3h10a4 4 0 0 0 0-8h-1V8h1a6 6 0 0 1 0 12H7v3z"></path></svg></button> <!> <p class="svelte-kd7dba"> </p></div>');function _e(P,f){q(f,!1);let o=M(f,"display_ui",8,!0),t,v=_(),n,s=_(!1),y=0,m=0,l=_(0),h=_(0),x=_();const g=async a=>{b();let u;if(a instanceof File||a instanceof Blob)u=await a.arrayBuffer();else if(typeof a=="string")try{const c=await fetch(a,{mode:"cors"});if(!c.ok)throw new Error(`Fetch failed with status ${c.status}`);u=await c.arrayBuffer()}catch(c){throw console.error("Audio load failed:",c),new Error(`Unable to load audio from URL "${a}". If this is a remote file, ensure the server enables CORS.`)}else throw new Error("load_audio expects a File, Blob, or URL string");return t=new AudioContext,i(v,await t.decodeAudioData(u)),i(h,e(v).duration),i(l,0),m=0,e(v)};function F(){if(e(s)==!1){if(!e(v))return;let a=Number(m);Number.isFinite(a)||(a=0),n=t.createBufferSource(),n.buffer=e(v),n.connect(t.destination),n.start(0,a),y=t.currentTime-a,i(s,!0),w()}else k()}function k(){n&&(n.stop(),m=e(l),i(s,!1))}function b(){n&&n.stop(),i(s,!1),m=0,i(l,0)}function p(a){k(),i(l,m=Math.min(Math.max(a,0),e(h))),e(s)&&F(e(l))}const r=(a,u)=>{b();const c=u-a;c<=0||(n=t.createBufferSource(),n.buffer=e(v),n.connect(t.destination),n.start(0,a,c),y=t.currentTime-a,i(s,!0),n.onended=()=>{i(s,!1),i(l,u),m=u},w())};function w(){if(e(s)){if(i(l,t.currentTime-y),e(l)>=e(h)){i(l,e(h)),i(s,!1);return}requestAnimationFrame(w),e(x).render()}}var R={load_audio:g,playSegment:r};X();var L=ee(),Q=ae(L);{var j=a=>{var u=fe(),c=A(u),G=A(c);{var Y=d=>{var T=ce();B(d,T)},Z=d=>{var T=de();B(d,T)};D(G,d=>{e(s)?d(Y):d(Z,!1)})}z(c);var H=C(c,2),I=C(H,2),N=C(I,2);K(le(N,{get audioBuffer(){return e(v)},get currentTime(){return e(l)},get duration(){return e(h)},$$events:{seek:d=>{p(d.detail.seek_to)}},$$legacy:!0}),d=>i(x,d),()=>e(x));var U=C(N,2),$=A(U);z(U),z(u),re((d,T)=>ie($,`${d??""}/${T??""}`),[()=>(e(l),V(()=>e(l).toFixed(3))),()=>(e(h),V(()=>e(h).toFixed(3)))]),S("click",c,F),S("click",H,b),S("click",I,b),B(a,u)};D(Q,a=>{o()===!0&&a(j)})}return B(P,L),E(f,"load_audio",g),E(f,"playSegment",r),J(R)}export{_e as A};
